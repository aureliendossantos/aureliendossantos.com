---
import "$styles/fonts/inter.css"
import BaseLayout from "$layouts/BaseLayout.astro"
import ogImage from "$styles/assets/open-graph/portfolio-og.png"
import "overlayscrollbars/overlayscrollbars.css"
import LinkItem from "$components/portfolio/LinkItem.astro"
import School from "$components/portfolio/School.astro"
import Circle from "$components/portfolio/Circle.astro"
import SkillChoice from "$components/portfolio/SkillChoice.astro"
import Overview from "$components/portfolio/Overview.astro"
import { getCollection, z } from "astro:content"
import { dateSort } from "$utils/sort"
import { date as dateType, period as periodType } from "src/content.config"
import { localePaths } from "$utils/i18n"

export function getStaticPaths() {
	return localePaths
}
const { t, locale } = Astro.props

const customToJsDate = (period: z.infer<typeof periodType> | z.infer<typeof dateType>) => {
	const date = Array.isArray(period) ? period[1] : period
	return new Date(date.y!, typeof date.m == "number" ? date.m - 1 : 0, date.d || 1)
}

const entries = (await getCollection("portfolio"))
	.filter((entry) => {
		if (locale === "en") return entry.id.endsWith("/en")
		return !entry.id.endsWith("/en")
	})
	.sort((a, b) => {
		return dateSort(customToJsDate(a.data.date), customToJsDate(b.data.date))
	})
---

<BaseLayout
	ogType="website"
	bg="#FFFCF0"
	image={ogImage.src}
	title={t("p-title")}
	description={t("p-description")}
	navBarProps={{ title: t("p-title") }}
>
	<div
		class="m-auto max-w-[820px] px-[43px] font-inter text-fi-black mediumlarge:overflow-x-hidden medium:text-lg"
	>
		<header class="flex min-h-[calc(100svh)] flex-col justify-center py-14">
			<div
				class="relative"
				style={{
					"text-shadow": `
						2px 0px #FFFCF0,
						2px 1px #FFFCF0,
						2px 2px #FFFCF0,
						-1px -1px #FFFCF0,
						1px -1px #FFFCF0, 1px -2px #FFFCF0,
						-1px 1px #FFFCF0, -2px 0px #FFFCF0, -2px -1px #FFFCF0, -2px -2px #FFFCF0, -2px 1px #FFFCF0, -2px 2px #FFFCF0, 0px 2px #FFFCF0, 0px -2px #FFFCF0`,
				}}
			>
				<Circle />
				<a href="/" class="text-lg font-medium transition hover:text-fi-orange"
					>{t("p-hero-name")}
				</a>
				<div class="-ml-[3px] text-6xl font-medium" style={{ fontFeatureSettings: '"dlig"' }}>
					{t("p-hero-title")}
				</div>
			</div>
			<div class="mt-12 grid grid-cols-2 gap-3 text-sm medium:grid-cols-1">
				<div class="flex flex-col justify-between pr-[21.5px] medium:order-2 medium:pr-0">
					<div>
						<LinkItem
							href="https://www.youtube.com/@GameDevAlliance"
							site={t("p-link-youtube")}
							username={t("p-username-youtube")}
						/>
						<LinkItem
							href="https://www.linkedin.com/in/aureliendossantos/"
							site={t("p-link-linkedin")}
							username={t("p-username-linkedin")}
						/>
						<LinkItem
							href="https://github.com/aureliendossantos"
							site={t("p-link-github")}
							username={t("p-username-github")}
						/>
						<LinkItem
							href="mailto:aureliendsantos@gmail.com"
							site={t("p-link-email")}
							username={t("p-username-email")}
						/>
					</div>
				</div>
				<p class="pl-[21.5px] medium:pl-0">
					{t("p-role-summary")}
				</p>
			</div>
			<div class="mt-12 text-sm">
				<div class="mb-3 text-xs font-medium uppercase tracking-wider text-fi-base-400">
					{t("p-filter-title")}
				</div>
				<div class="group grid grid-cols-3 gap-x-3 gap-y-2 pt-[3px] medium:grid-cols-1">
					<SkillChoice
						title={t("p-skill-pedagogique")}
						value="pedagogique"
						color="#4385BE"
						deg={90}
					/>
					<SkillChoice title={t("p-skill-web")} value="web" color="#DA702C" deg={135} />
					<SkillChoice title={t("p-skill-games")} value="jeux" color="#D0A215" deg={0} />
				</div>
			</div>
		</header>
	</div>
	<div
		id="skills-overlay"
		class="pointer-events-none fixed left-0 right-0 top-0 z-20 border-b border-fi-ui bg-fi-paper p-2 pb-[10px] pt-[7px] text-sm opacity-0 transition-opacity mediumlarge:hidden"
	>
		<div
			class="group relative m-auto grid max-w-[735px] grid-cols-3 gap-x-3 gap-y-2 pt-[3px] medium:grid-cols-1"
		>
			<div
				class="absolute -left-[68px] top-[9px] mb-3 text-xs font-medium uppercase tracking-wider text-fi-base-400"
			>
				{t("p-filter-short")}
			</div>
			<SkillChoice
				small
				title={t("p-skill-pedagogique")}
				value="pedagogique"
				color="#4385BE"
				deg={90}
			/>
			<SkillChoice small title={t("p-skill-web")} value="web" color="#DA702C" deg={135} />
			<SkillChoice small title={t("p-skill-games")} value="jeux" color="#D0A215" deg={0} />
			<label
				class="absolute -right-9 top-1 mb-3 cursor-pointer rounded-full px-2 py-1 text-xs font-medium text-fi-base-400 ring-fi-ui-2 transition hover:ring-1"
				aria-label={t("p-close")}
			>
				<input id="close-skills-overlay" type="checkbox" class="hidden" />
				✕
			</label>
		</div>
	</div>
	<div class="m-auto max-w-6xl px-[43px]">
		{entries.map((entry) => <Overview id={entry.id} />)}
	</div>
	<div class="m-auto my-24 max-w-[820px] px-[43px] font-inter text-xl medium:text-lg">
		<h2 class="mb-6 mt-12 text-sm font-medium text-fi-orange-500">{t("p-education")}</h2>
		<School degree={t("p-degree-master")} school={t("p-school-master")} />
		<ul class="hidden list-disc text-sm leading-relaxed marker:text-fi-base-100 medium:text-sm">
			<li>Ingénierie pédagogique</li>
			<li>
				Conception pédagogique multimédia
				<ul class="text-fi-base-300">
					<li>Rise, Storyline, Genially, Vyond</li>
					<li>Adobe Premiere, Photoshop, InDesign</li>
				</ul>
			</li>
			<li>
				Développement web
				<ul class="text-fi-base-300">
					<li>HTML & CSS, JavaScript, PHP, SQL, React, Next.js, Elixir</li>
				</ul>
			</li>
			<li>
				Développement d'applications et jeux sérieux
				<ul class="text-fi-base-300">
					<li>Unity (C#), Ren’Py (Python)</li>
				</ul>
			</li>
		</ul>
		<School degree={t("p-degree-licence")} school={t("p-school-licence")} />
		<School degree={t("p-degree-iut")} school={t("p-school-iut")} />
	</div>
	<div class="my-24 flex justify-center gap-3 text-sm">
		<button
			id="back-to-top"
			class="flex cursor-pointer items-center gap-2 rounded-full p-3 pr-4 leading-tight text-fi-tx-2 ring-2 ring-fi-tx-2 transition ease-out"
		>
			<div class="inline-block font-medium">↑</div>
			<div>{t("p-back-to-top")}</div>
		</button>
		{
			/*
		<button
			id="all-projects"
			class="bg-fi-tx-3 ring-fi-tx-3 hover:bg-fi-bg-2 flex cursor-pointer items-center gap-2 rounded-full p-3 pr-4 leading-tight text-fi-paper ring-2 transition ease-out"
		>
			<div class="inline-block aspect-square h-[1em] rounded-full border-2 border-fi-paper"></div>
			<div>Tous les projets</div>
		</button>*/
		}
	</div>
</BaseLayout>

<script>
	document.querySelector("#back-to-top")?.addEventListener("click", () => {
		window.scrollTo({ top: 0, behavior: "smooth" })
	})
	document.querySelector("#all-projects")?.addEventListener("click", () => {
		window.scrollTo({ top: window.innerHeight / 2, behavior: "smooth" })
	})
	// If the user has scrolled for more than window.innerHeight, show the skills overlay. Hide it if the user scrolls back up, or clicks the close button.
	const skillsOverlay = document.querySelector("#skills-overlay") as HTMLElement
	const closeSkillsOverlay = document.querySelector("#close-skills-overlay") as HTMLInputElement
	const showSkillsOverlay = () => {
		skillsOverlay.style.opacity = "1"
		skillsOverlay.style.pointerEvents = "auto"
	}
	const hideSkillsOverlay = () => {
		skillsOverlay.style.opacity = "0"
		skillsOverlay.style.pointerEvents = "none"
	}
	document.addEventListener("scroll", () => {
		if (window.scrollY >= window.innerHeight - 80 && !closeSkillsOverlay.checked) {
			showSkillsOverlay()
		} else {
			hideSkillsOverlay()
		}
	})
	closeSkillsOverlay.addEventListener("change", () => {
		hideSkillsOverlay()
	})
</script>

<script>
	import { OverlayScrollbars, ScrollbarsHidingPlugin, ClickScrollPlugin } from "overlayscrollbars"
	OverlayScrollbars.plugin([ScrollbarsHidingPlugin, ClickScrollPlugin])
	OverlayScrollbars(document.body, { scrollbars: { clickScroll: true } })
</script>

<style is:global>
	.os-scrollbar {
		--os-track-bg-hover: #efeee3;
		--os-track-border-hover: 1px solid #dad8ce;
		--os-handle-bg: #e6e4d9;
		--os-handle-border: 1px solid #dad8ce;
		--os-handle-bg-hover: #b7b5ac;
		--os-handle-border-hover: 1px solid #9f9d96;
		--os-handle-bg-active: #9f9d96;
		--os-handle-border-active: 1px solid #878580;
		--os-padding-perpendicular: 2px 30px;
	}
</style>
