---
import OptionalLink from "$components/OptionalLink.astro"
import BaseLayout from "$layouts/BaseLayout.astro"
import getGames from "$utils/notion/getGames"
import { emotes } from "$utils/notion/reviewEmotes"

const firstResultsOnly = import.meta.env.DEV
const { games, notionResponse } = await getGames(
	{
		and: [
			{ property: "Type", select: { equals: "Jeu" } },
			{
				or: [
					{ property: "Progression", status: { does_not_equal: "À faire" } },
					{ property: "Appréciation", select: { is_not_empty: true } },
				],
			},
		],
	},
	firstResultsOnly
)
games.sort((a, b) => a.title.localeCompare(b.title))
---

<BaseLayout title="Jeux" ogType="website" bg="white">
	<header class="m-auto my-8 max-w-prose px-2">
		<h1 class="mb-3 text-xl">Jeux auxquels j'ai joué</h1>
		<p>
			Cette page est en cours de réalisation. Les 📝 indiquent qu'un rapide avis écrit est
			disponible sur la page du jeu.
		</p>
	</header>
	<main class="m-auto my-8 max-w-prose px-2">
		<table class="mb-8 w-full px-2">
			<thead>
				<tr class="border-b border-slate-300 text-left">
					<th colspan="2" class="py-3 pl-3">Jeu</th><th>Progression</th><th colspan="4"
						>Multijoueur</th
					>
				</tr>
			</thead>
			<tbody class="text-slate-900">
				{
					games.map((item) => (
						<tr class="even:bg-slate-50">
							<td class:list={["py-3 pl-3", { "font-medium text-indigo-700": item.slug }]}>
								<OptionalLink href={item.slug && `/games/${item.slug}`}>
									{item.title}
									{item.review && " 📝"}
								</OptionalLink>
							</td>
							<td>{emotes[item.quickReview] ? emotes[item.quickReview] : item.quickReview}</td>
							<td class="text-slate-500">{item.progress != "À faire" && item.progress}</td>
							<td>{item.multiplayer.includes("Local") && "🛋️"}</td>
							<td>{item.multiplayer.includes("En ligne") && "🛜"}</td>
							<td>{item.multiplayer.includes("Coop") && "🤝"}</td>
							<td>{item.multiplayer.includes("Versus") && "🆚"}</td>
						</tr>
					))
				}
			</tbody>
		</table>
	</main>
	{/*import.meta.env.DEV && <pre>{JSON.stringify(notionResponse, null, 2)}</pre>*/}
</BaseLayout>

<style is:global>
	@tailwind base;
	@tailwind components;
	@tailwind utilities;
	td:not(:last-of-type) {
		@apply pr-2;
	}
</style>
