---
import OptionalLink from "$components/OptionalLink.astro"
import BaseLayout from "$layouts/BaseLayout.astro"
import getGames from "$utils/notion/getGames"
import { emotes } from "$utils/notion/reviewEmotes"

const firstResultsOnly = import.meta.env.DEV
const { games, notionResponse } = await getGames(
	{
		and: [
			{ property: "Type", select: { equals: "Jeu" } },
			{
				or: [
					{ property: "Progression", status: { does_not_equal: "À faire" } },
					{ property: "Appréciation", select: { is_not_empty: true } },
				],
			},
		],
	},
	firstResultsOnly
)
games.sort((a, b) => a.title.localeCompare(b.title))
---

<BaseLayout title="Jeux" ogType="website" bg="white" bgDark="black" font="Work Sans">
	<header class="m-auto my-8 max-w-prose px-4">
		<h1 class="mb-3 text-xl text-slate-900 dark:text-slate-100">Jeux auxquels j'ai joué</h1>
		<div class="prose prose-slate dark:prose-invert">
			<p>
				Cette page recense les jeux auxquels j'ai joué et ce que j'en ai pensé. Pour les jeux qui
				n'ont pas de fin, je note si j'y joue « souvent » ou « rarement ».
			</p>
			<p>
				📝 indique qu'un rapide avis écrit est disponible sur la page du jeu.<br />📖 indique que le
				texte est un peu plus long.
			</p>
		</div>
	</header>
	<main class="m-auto my-8 max-w-prose">
		<table class="mb-8 w-full">
			<thead>
				<tr class="border-b border-slate-300 text-left">
					<th colspan="2" class="py-3 pl-3">Jeu</th><th>Progression</th><th colspan="4"
						>Multijoueur</th
					>
				</tr>
			</thead>
			<tbody class="text-slate-900 dark:text-slate-200">
				{
					games.map((item) => (
						<tr class="even:bg-slate-50 dark:even:bg-slate-900">
							<td
								class:list={[
									"py-3 pl-4 max-w-[26ch]",
									{ "font-medium text-indigo-700 dark:text-indigo-400": item.slug },
								]}
							>
								<OptionalLink href={item.slug && `/games/${item.slug}`}>
									{item.title}
									{item.blocks.length > 0 ? " 📖" : item.review && " 📝"}
								</OptionalLink>
							</td>
							<td>{emotes[item.quickReview] ? emotes[item.quickReview] : item.quickReview}</td>
							<td class="text-slate-500">{item.progress != "À faire" && item.progress}</td>
							<td>{item.multiplayer.includes("Local") && "🛋️"}</td>
							<td>{item.multiplayer.includes("En ligne") && "🛜"}</td>
							<td>{item.multiplayer.includes("Coop") && "🤝"}</td>
							<td class="pr-4">{item.multiplayer.includes("Versus") && "🆚"}</td>
						</tr>
					))
				}
			</tbody>
		</table>
	</main>
	{/*import.meta.env.DEV && <pre>{JSON.stringify(notionResponse, null, 2)}</pre>*/}
</BaseLayout>

<style is:global>
	@tailwind base;
	@tailwind components;
	@tailwind utilities;
	td:not(:last-of-type) {
		@apply pr-2;
	}
</style>
