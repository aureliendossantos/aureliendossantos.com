---
import RefBlock from "$components/RefBlock.astro"
import getIGDBgames, { IGDBData } from "$utils/getIGDBgame"

interface Props {
	slug?: string
	data?: IGDBData
}
const { slug, data } = Astro.props

if (!slug && !data) {
	throw new Error("You must provide a slug or data for the Game component.")
}
const game = data || (await getIGDBgames([slug]))[0]
const officialWebsites = game.websites.filter((w: any) => w.category == 1)
const links: [string, string][] =
	officialWebsites.length > 0
		? [
				[officialWebsites[0].url, officialWebsites[0].url],
				["IGDB", game.url],
		  ]
		: [["IGDB", game.url]]
---

<RefBlock
	img={`https://images.igdb.com/igdb/image/upload/t_cover_small_2x/${game.cover.image_id}.jpg`}
	title={`${game.name} (${game.release_dates[0].y})`}
	infos={[
		"Développé par " +
			game.involved_companies
				.filter((i: any) => i.developer)
				.map((i: any) => i.company.name)
				.join(", "),
		"Édité par " +
			game.involved_companies
				.filter((i: any) => i.publisher)
				.map((i: any) => i.company.name)
				.join(", "),
		"Disponible sur " + game.platforms.map((p: any) => p.abbreviation).join(", "),
	]}
	links={links}
/>
